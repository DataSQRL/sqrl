name: Cleanup Package Versions

on:
  schedule:
    # Run every Monday at 2 AM UTC
    - cron: '0 2 * * 1'
  workflow_dispatch: # Allow manual triggering

jobs:
  cleanup-maven-packages:
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read

    strategy:
      matrix:
        package-name:
          - 'com.datasqrl.sqrl-root'
          - 'com.datasqrl.sqrl-tools'
          - 'com.datasqrl.sqrl-cli'

    steps:
      - name: Delete old Maven package versions for ${{ matrix.package-name }}
        uses: actions/delete-package-versions@v5
        with:
          package-name: ${{ matrix.package-name }}
          package-type: 'maven'
          min-versions-to-keep: 10
          delete-only-pre-release-versions: true
          token: ${{ secrets.GITHUB_TOKEN }}

  cleanup-docker-packages:
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read

    steps:
      - name: Delete old Docker package versions for cmd
        uses: actions/delete-package-versions@v5
        with:
          package-name: 'cmd'
          package-type: 'container'
          min-versions-to-keep: 10
          delete-only-untagged-versions: true
          token: ${{ secrets.GITHUB_TOKEN }}
