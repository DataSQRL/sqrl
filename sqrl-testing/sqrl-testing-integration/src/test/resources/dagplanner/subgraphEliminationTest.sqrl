IMPORT ecommerceTs.*;
DistinctCustomer := DISTINCT Customer ON customerid ORDER BY `timestamp` DESC;
DistinctProduct := DISTINCT Product ON productid ORDER BY `_ingest_time` DESC;


_TemporalJoin1 := SELECT * FROM Orders o JOIN DistinctCustomer FOR SYSTEM_TIME AS OF `time` c ON o.customerid = c.customerid;

_TemporalJoin2 := SELECT * FROM _TemporalJoin1 j1 JOIN DistinctProduct FOR SYSTEM_TIME AS OF `time` p ON j1.id = p.productid;

_Out1 := SELECT customerid, email FROM _TemporalJoin2;
_Out2 := SELECT productid, name FROM _TemporalJoin2;

-- these sinks cause the temporal joins to be duplicated 3 times
EXPORT _TemporalJoin2 to logger.Out1;
EXPORT _TemporalJoin2 to logger.Out2;
EXPORT _Out1 to logger.Out3;
EXPORT _Out2 to logger.Out4;
