IMPORT time.*;
IMPORT ecommerceTs.customer;
IMPORT ecommerceTs.orders;
IMPORT ecommerceTs.product;
OrderAgg1 := SELECT o.customerid as customer, endOfHour(o.time, 1, 15) as bucket, COUNT(o.id) as order_count FROM Orders o GROUP BY customer, bucket;
OrderAgg2 := SELECT COUNT(o.id) as order_count FROM Orders o;
Ordertime1 := SELECT o.customerid as customer, endOfSecond(o.time) as bucket, COUNT(o.id) as order_count FROM Orders o GROUP BY customer, bucket;
OrderNow1 := SELECT o.customerid as customer, endOfDay(o.time) as bucket, COUNT(o.id) as order_count FROM Orders o  WHERE (o.time > NOW() - INTERVAL 8 DAY) GROUP BY customer, bucket;
OrderNow2 := SELECT endOfDay(o.time) as bucket, COUNT(o.id) as order_count FROM Orders o  WHERE (o.time > NOW() - INTERVAL 8 DAY) GROUP BY bucket;
OrderNow3 := SELECT o.customerid as customer, COUNT(o.id) as order_count FROM Orders o  WHERE (o.time > NOW() - INTERVAL 8 DAY) GROUP BY customer;
OrderAugment := SELECT o.id, o.time, c.order_count FROM Orders o JOIN OrderNow3 c ON o.customerid = c.customer;
RecentTotal := SELECT sum(e.unit_price * e.quantity) AS total, sum(e.quantity) AS quantity FROM Orders o JOIN o.entries e WHERE o.time > now() - INTERVAL 7 DAY;
