IMPORT loan-local.Applications AS _Applications;
IMPORT loan-local.Loan_Types AS _LoanTypes;
IMPORT loan-local.ApplicationUpdates AS _ApplicationUpdates

_Applications := DISTINCT _Applications ON id ORDER BY updated_at DESC;
_LoanTypes := DISTINCT _LoanTypes ON id ORDER BY updated_at DESC;

ApplicationStatus := SELECT u.status, u.message, u.event_time, a.id, a.customer_id, a.loan_type_id,
                            a.amount, a.duration, t.max_amount, t.min_amount
                     FROM _ApplicationUpdates u JOIN _Applications a ON a.id = u.loan_application_id
                                               JOIN _LoanTypes t ON t.id = a.loan_type_id;

/*+exec(iceberg) */
ApplicationInfo := SELECT * FROM _Applications a JOIN _LoanTypes t ON t.id = a.loan_type_id;

/*+test */
ApplicationStatusTest := SELECT status, COUNT(1) AS num FROM ApplicationStatus ORDER BY status ASC;

/*+test */
ApplicationInfoTest := SELECT COUNT(1) AS num FROM ApplicationInfo;